#  가상 면접 사례로 배우는 대규모 시스템 설계 기초
## 1장
### 데이터 베이스의 규모 확장
###  종류
  * 수직적 확장
  * 수평적 확장

#### 수평적 확장
* 데이터 베이스의 수평적 확장은 샤딩(sharding)이라고 함.
* 샤딩은 대규모 데이터베이스를 샤드(shard)라는 작은 데이터베이스로 분할하는 것을 의미
* 모든 샤드는 같은 스키마를 쓰지만 샤드에 보관되는 데이터 사이에는 중복이 없다.
* ex) product_id % 4를 해시 함수로 사용하여 4개의 샤드로 분할  
  결과가 0 이면 0번 샤드, 1이면 1번 샤드에 보관하는 방식.


#### 샤딩 전략 구현시 고려할 사항
* 위의 product_id는 샤딩 키 또는 파티션 키 라고 함.
* 샤딩 키를 통해 올바른 데이터베이스에 질의를 보내어 데이터 조회나 변경을 처리하므로 효율 높일 수 있다.
* 샤딩 키를 정할 때는 데이터를 고르게 분할 할 수 있도록 해야함.
* 샤딩은 데이터베이스 규모 확장을 실현하는 훌륭한 기술이지만 완변하진 않아  
  샤딩을 도입하면 시스템이 복잡해지고 풀어야 할 새로운 문제도 생김.  


#### 샤딩의 풀어야 할 문제
* 데이터의 재 샤딩 : 재 샤딩은 다음과 같은 경우에 필요하다.
  1. 데이터가 너무 많아져서 하나의 샤드로는 더 이상 감당하기 어려울 떄.
  2. 샤드 소진(shard exhaustion) : 샤드 간 데이터 분포가 균등하지 못하여 어떤 샤드에 할당된 공간 소모가 다른 샤드에 비해 빨리 차는 경우.  
   이런 현상이 발생하면 샤드 키를 계산하는 함수를 변경하고 데이터를 재 배치하여야 한다. ( 안정 해시 consistent hashing 기법으로 해결)  
<br />  

* 유명인사(celebrity) 핫스팟 키 문제 : 특정 샤드에 질의가 집중되어 서버에 과부하가 걸리는 문제  
  ex) 저스틴 비버, 레이디 가가 등의 유명인사가 같은 샤드에 저장되는 데이터베이스가 있다고 가정,   
  이 데이터베이스로 SNS 어플리케이션을 구축하게 되면 결국 해당 샤드에 read 연상 때문에 과부하가 걸리게 될 것이다.  
  이를 해결하기 위해선 각각의 유명인사를 각각 다른 샤드에 할당해야 할 수도 있고, 심지어는 더 잘게 쪼개야 할 수도 있다.  
<br />  

* 조인과 비정규화 :   
 일단 하나의 데이터베이스를 여러 샤드 서버로 쪼개고 나면, 여러 샤드에 걸친 데이터를 조인하기가 힘들어진다.  
 이를 해결하는 한 가지 방법은 데이터베이스를 비정규화하여 하나의 테이블에서 질의가 수행될 수 있도록 하는 것이다.

### 백만 사용자, 그리고 그 이상
* 시스템 규모 확장을 위한 기법들
* 웹 계층은 무상태 계층으로
* 모든 계층에 다중화 도입
* 가능한 한 많은 데이터를 캐시할 것
* 여러 데이터 센터를 지원할 것
* 정적 콘텐츠는 CDN을 통해 서비스할 것
* 데이터 계층은 샤딩을 통해 그 규모를 확장할 것
* 각 계층은 독립적 서비스로 분할할 것
* 시스템을 지속적으로 모니터링하고, 자동화 도구들을 활용할 것


___
___

## 2장
### 개략적인 규모 추정
